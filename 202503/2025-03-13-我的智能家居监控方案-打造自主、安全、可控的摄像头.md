# 我的智能家居监控方案:打造自主、安全、可控的摄像头
- URL: https://luolei.org/secure-home-camera-setup
- Added At: 2025-03-13 07:05:15
- [Link To Text](2025-03-13-我的智能家居监控方案-打造自主、安全、可控的摄像头_raw.md)

## TL;DR
本文介绍了一种自建监控方案，通过使用支持ONVIF协议的IP摄像头、群晖NAS和Home Assistant等工具，实现了本地存储、内网访问的监控系统。该方案强调隐私保护，避免云服务带来的风险，并详细描述了设备清单、系统架构、配置步骤及自动化功能。虽然操作复杂，但提供了高安全性和经济性，适合对隐私有高要求的用户。

## Summary
1. **自建监控方案简介**：
   - 使用支持`ONVIF`协议的`IP摄像头`，通过`ONVIF`协议接入群晖的监控`Surveillance Station`。
   - 视频存储在群晖外挂的USB硬盘上，配合`Home Assistant`和`Node-RED`实现自动化功能。
   - 摄像头断开外网访问，仅限内网或VPN访问，确保视频安全。

2. **自建监控的原因**：
   - 保护隐私和数据安全，避免云服务带来的隐私泄露风险。
   - 摄像头是极其敏感的设备，直接打破网络与现实的边界。
   - 过去曾发生云存储服务未加密存储用户监控视频的事件，导致用户隐私泄露。

3. **自建监控方案的优缺点**：
   - **操作性**：需要折腾，较为麻烦。
   - **安全性**：本地存储，内网访问，理论可与外网完全隔离。
   - **经济性**：无额外费用。
   - **存储空间**：无空间限制，理论可无限拓展存储。
   - **共享性**：不方便共享给家人。
   - **外网访问**：仅限VPN访问（不建议开启公网权限）。
   - **HomeKit支持**：支持。

4. **设备清单**：
   - **摄像头**：TP-Link TL-IPC48AW，￥279。
   - **NAS**：群晖 DS216+，￥0（旧设备）。
   - **外接硬盘盒**：2.5寸 USB3.1 Type-C 硬盘盒，￥21。
   - **外接监控存储SSD**：饥饿鲨OCZ Arc100 240G固态硬盘，￥0（旧设备）。

5. **系统架构**：
   - **SurveillanceStation**：群晖自带监控中心套件，配置难度低。
   - **Home Assistant**：开源智能家庭解决方案，配置难度高。
   - **Node-RED**：开源的流程编排工具，配置难度高。

6. **配套App**：
   - **Home Assistant**：支持安卓、iOS、Web，实时监控，推送信息。
   - **DS CAM**：群晖监控套件的配套App，支持安卓、iOS，实时监控，回放，推送信息。
   - **Bark**：自建的iOS消息推送服务。
   - **Telegram**：极其方便和自由的社交App，支持安卓、iOS、Web，推送信息。

7. **摄像头选购**：
   - 基本要求是摄像头支持`ONVIF`协议或`rtsp`协议。
   - 购买的TP-Link TL-IPC48AW支持`ONVIF`协议，4K 15帧录制，WIFI 2.4G，红外夜视，支持Micro SD卡存储，1个RJ45口。

8. **关闭摄像头外网访问**：
   - 设置摄像头固定IP，在路由器层禁止该IP访问外网。
   - 使用OpenWrt等网关，在防火墙层设置屏蔽规则。

9. **配置外网访问**：
   - 通过`zerotier`或`WireGuard`等工具实现内网穿透，避免摄像头直接暴露在外网。

10. **接入群晖SurveillanceStation**：
    - 群晖的`SurveillanceStation`是监控系统的核心，支持`ONVIF`协议接入摄像头。

11. **将监控视频存储到外接USB硬盘**：
    - 使用外接USB硬盘存储监控视频，避免影响主硬盘寿命。
    - 通过SSH登录群晖，使用`ln -s`软链方式挂载外接硬盘。

12. **接入HomeKit**：
    - 通过`Home Assistant`将摄像头接入HomeKit，实现iPhone的Home App查看监控视频。

13. **监控效果**：
    - 通过群晖的`DS Cam`进行实时监控和回放，支持动静标记。
    - 通过iOS的`Home`和`Home Assistant`查看监控画面，延迟较大。

14. **进阶功能：动静通知和自动化管理**：
    - 通过`SurveillanceStation`、`Home Assistant`和`Node-RED`实现自动化功能。
    - 设置在家模式、离家模式和动静通知规则，通过WebHook接口触发摄像头开关和通知。

15. **HA自动化：离家自动开启摄像头**：
    - 通过`Home Assistant`实现离家时自动开启摄像头，发送通知到手机。

16. **Node-RED自动化：推送Telegram**：
    - 通过`Node-RED`实现监控画面动静时截取画面并推送到Telegram。

17. **总结**：
    - 自建监控方案实现了功能完善、安全经济的自主监控系统。
    - 通过折腾，获得了更安全和可控的监控体验，未来还可以扩展更多功能，如云端存储、人脸识别等。
